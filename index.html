<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM å®¢æˆ·ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/datacenter.css">
    <!-- Remix Icon (æœ¬åœ°) -->
    <link rel="stylesheet" href="lib/remixicon/remixicon.css">
    <style>
        /* ç”¨æˆ·åŒºåŸŸæ ·å¼ */
        .user-section {
            margin-top: auto;
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 0;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .user-avatar i {
            font-size: 18px;
            color: white;
        }

        .user-details {
            flex: 1;
            min-width: 0;
        }

        .user-email {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }

        .logout-btn {
            width: 36px;
            height: 36px;
            background: rgba(239, 68, 68, 0.15);
            border: none;
            border-radius: 10px;
            color: #ef4444;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.25);
        }

        .logout-btn i {
            font-size: 18px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- ä¾§è¾¹å¯¼èˆªæ  -->
        <aside class="sidebar">
            <div class="logo">
                <h1>é€ç±³æ—¶ä»£</h1>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="ri-dashboard-3-line"></i>
                    <span class="text">é¦–é¡µ</span>
                </a>
                <a href="#" class="nav-item" data-page="employees">
                    <i class="ri-team-line"></i>
                    <span class="text">å‘˜å·¥ç®¡ç†</span>
                </a>
                <a href="#" class="nav-item" data-page="tasks">
                    <i class="ri-clipboard-line"></i>
                    <span class="text">ä»»åŠ¡è®°å½•</span>
                </a>
                <a href="#" class="nav-item" data-page="payments">
                    <i class="ri-money-cny-circle-line"></i>
                    <span class="text">å›æ¬¾è®°å½•</span>
                </a>
                <a href="#" class="nav-item nav-item-secret" data-page="ai-assistant" style="display: none;">
                    <i class="ri-robot-2-line"></i>
                    <span class="text">AIæ™ºèƒ½åŠ©ç†</span>
                </a>
            </nav>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">


            <!-- é¡µé¢å†…å®¹å®¹å™¨ -->
            <div id="page-content" class="page-content">
                <!-- åŠ¨æ€åŠ è½½çš„é¡µé¢å†…å®¹ -->
            </div>
        </main>
    </div>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- æç¤ºæ¡†å®¹å™¨ -->
    <div id="toast-container"></div>

    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- Supabase SDK (æœ¬åœ°) -->
    <script src="lib/supabase.min.js"></script>

    <!-- å¼•å…¥ç¬¬ä¸‰æ–¹åº“ (æœ¬åœ°) -->
    <script src="lib/xlsx.full.min.js"></script>
    <script src="lib/chart.min.js"></script>
    <script src="lib/chartjs-plugin-datalabels.min.js"></script>
    <script src="lib/marked.min.js"></script>

    <!-- å¼•å…¥åº”ç”¨æ¨¡å— -->
    <script src="js/utils.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/modules/dashboard.js"></script>
    <script src="js/modules/employees.js"></script>
    <script src="js/modules/taskRecords.js"></script>
    <script src="js/modules/payments.js"></script>
    <script src="js/modules/aiAssistant.js"></script>

    <script src="js/app.js"></script>

    <!-- ç§˜å¯†è§£é”è„šæœ¬ -->
    <script>
        (function () {
            const secretCode = 'jdthzz';
            let inputBuffer = '';
            let lastKeyTime = 0;

            // æ£€æŸ¥æ˜¯å¦å·²è§£é”ï¼ˆå½“å‰ä¼šè¯ï¼‰
            if (sessionStorage.getItem('ai_unlocked') === 'true') {
                const secretItem = document.querySelector('.nav-item-secret');
                if (secretItem) secretItem.style.display = '';
            }

            document.addEventListener('keydown', function (e) {
                const now = Date.now();
                // å¦‚æœè¶…è¿‡2ç§’æ²¡æŒ‰é”®ï¼Œé‡ç½®ç¼“å†²åŒº
                if (now - lastKeyTime > 2000) {
                    inputBuffer = '';
                }
                lastKeyTime = now;

                // å¿½ç•¥åŠŸèƒ½é”®å’Œè¾“å…¥æ¡†ä¸­çš„è¾“å…¥
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

                inputBuffer += e.key.toLowerCase();

                // åªä¿ç•™æœ€è¿‘çš„å­—ç¬¦
                if (inputBuffer.length > secretCode.length) {
                    inputBuffer = inputBuffer.slice(-secretCode.length);
                }

                // æ£€æŸ¥æ˜¯å¦åŒ¹é…ç§˜å¯†ä»£ç 
                if (inputBuffer === secretCode) {
                    const secretItem = document.querySelector('.nav-item-secret');
                    if (secretItem) {
                        secretItem.style.display = '';
                        sessionStorage.setItem('ai_unlocked', 'true');

                        // æ˜¾ç¤ºè§£é”åŠ¨ç”»
                        secretItem.style.animation = 'unlockPulse 0.6s ease';
                        Utils.showToast('ğŸ¤– AIæ™ºèƒ½åŠ©ç†å·²è§£é”ï¼', 'success');
                    }
                    inputBuffer = '';
                }
            });
        })();
    </script>
</body>

</html>